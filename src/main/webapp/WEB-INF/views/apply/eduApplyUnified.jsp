<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri ="http://java.sun.com/jsp/jstl/functions" prefix = "fn" %>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ko" lang="ko">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-368L9FRD5B"></script>
    <script>   window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-368L9FRD5B'); </script>

    <meta name="google-site-verification" content="nOdgBX2kjgySRAVZjwMl-AmYg53q0GxLBOV_qEtG7jk" />

    <meta name="naver-site-verification" content="8027433e606d42e31ef9e566afbd709c593e33bc" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-language" content="ko">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no" />
    <meta name="copyright" content="경기테크노파크">
    <meta name="robots" content="all">
    <meta property="og:locale" content="ko_KR">
    <meta itemprop="inLanguage" content="ko-kr">
    <meta name="resource-type" content="website">
    <meta property="og:type" content="website">

    <meta property="og:site_name" content="경기해양레저인력양성센터">
    <title>경기해양레저 인력양성센터</title>

    <meta name="title" content="경기해양레저인력양성센터">
    <meta property="og:title" content="경기해양레저인력양성센터">
    <meta name="twitter:title" content="경기해양레저인력양성센터">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://edumarine.org/main.do">
    <meta itemprop="name" content="경기해양레저인력양성센터">
    <meta property="nate:title" content="경기해양레저인력양성센터">
    <meta property="nate:url" content="https://edumarine.org/main.do">

    <meta property="og:url" content="https://edumarine.org/main.do">
    <meta itemprop="url" content="https://edumarine.org/main.do">
    <link rel="canonical" id="canonical" href="https://edumarine.org/main.do">

    <meta name="description" content="경기해양레저인력양성센터는 경기도가 ‘16년도에 전국 최초로 개설한 해양레저 테크니션 전문교육기관입니다.">
    <meta name="twitter:description" content="경기해양레저인력양성센터는 경기도가 ‘16년도에 전국 최초로 개설한 해양레저 테크니션 전문교육기관입니다.">
    <meta property="og:description" content="경기해양레저인력양성센터는 경기도가 ‘16년도에 전국 최초로 개설한 해양레저 테크니션 전문교육기관입니다.">
    <meta itemprop="description" content="경기해양레저인력양성센터는 경기도가 ‘16년도에 전국 최초로 개설한 해양레저 테크니션 전문교육기관입니다.">
    <meta property="nate:description" content="경기해양레저인력양성센터는 경기도가 ‘16년도에 전국 최초로 개설한 해양레저 테크니션 전문교육기관입니다.">

    <meta property="og:keywords" content="경기해양레저인력양성센터, EDU marine, 에듀마린, 해상엔진, 해상엔진 교육, 선박엔진, 선박엔진 교육, 선외기, 선외기 교육, 선외기 정비 교육, 선내기, 선내기 교육, 선외기 정비 교육, 선체, 선체 교육, 선체 정비 교육, 해양레저, 해양레저 교육, 요트 교육, 요트정비 교육, 엔진정비 교육  편집 지켜보기">
    <meta name="keywords" content="경기해양레저인력양성센터, EDU marine, 에듀마린, 해상엔진, 해상엔진 교육, 선박엔진, 선박엔진 교육, 선외기, 선외기 교육, 선외기 정비 교육, 선내기, 선내기 교육, 선외기 정비 교육, 선체, 선체 교육, 선체 정비 교육, 해양레저, 해양레저 교육, 요트 교육, 요트정비 교육, 엔진정비 교육  편집 지켜보기">
    <meta property="twitter:keywords" content="경기해양레저인력양성센터, EDU marine, 에듀마린, 해상엔진, 해상엔진 교육, 선박엔진, 선박엔진 교육, 선외기, 선외기 교육, 선외기 정비 교육, 선내기, 선내기 교육, 선외기 정비 교육, 선체, 선체 교육, 선체 정비 교육, 해양레저, 해양레저 교육, 요트 교육, 요트정비 교육, 엔진정비 교육  편집 지켜보기">

    <meta name="image" content="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">
    <meta name="twitter:image " content="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">
    <meta property="og:image" content="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">
    <meta itemprop="image" content="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">
    <meta itemprop="thumbnailUrl" content="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">
    <link rel="image_src" link="https://cdn2.micehub.com/home/2017/edua/Files/edua_20210604_122121.jpg">

    <%-- favicon --%>
    <link rel="apple-touch-icon" sizes="57x57" href="/img/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/img/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/img/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/img/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/img/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/img/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/img/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <%-- favicon --%>

    <!-- swiper 외부 라이브러리 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

    <%-- sweetalert CDN --%>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css" rel="stylesheet">

    <link href="/css/reset.css" rel="stylesheet">
    <link href="/css/font.css" rel="stylesheet">
    <link href="/css/style.css?ver=<%=System.currentTimeMillis()%>" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">
</head>

<body>

<c:if test="${sessionScope.get('status') ne 'logon'}">
    <script>
        alert("로그인해 주세요.");
        location.href = '/member/login.do';
    </script>
</c:if>

<c:if test="${sessionScope.get('status') eq 'logon'}">

    <c:import url="../header.jsp" charEncoding="UTF-8"/>

    <form name="payForm" id="payForm" method="post">
        <input type="hidden" id="trainSeq" name="trainSeq" value="${seq}"/>
        <input type="hidden" id="tableSeq" name="tableSeq" value=""/>
        <input type="hidden" id="applicationSystemType" name="applicationSystemType" value=""/>
        <input type="hidden" id="buyername" name="buyername" value="${info.name}"/>
        <input type="hidden" id="buyertel" name="buyertel" value="${info.phone}"/>
        <input type="hidden" id="buyeremail" name="buyeremail" value="${info.email}"/>
    </form>

    <!-- container -->
    <div id="container" class="sub_page apply_page">
        <div class="sub_top_wrap">
            <div class="sub_top_bg" style="background-image:url(/static/img/bg_sub_top_02.jpg)">
                <div class="sub_top_title_wrap">
                    <div class="sub_top_title">
                        <h2>교육신청</h2>
                    </div>
                </div>
                <div class="sub_nav_wrap">
                    <div class="sub_nav">
                        <ul>
                            <li><a href="/">HOME</a></li>
                            <li><a href="/apply/schedule.do">교육신청</a></li>
                            <li><a href="/apply/schedule.do">교육일정</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="sub_content_wrap">
            <div class="sub_content">
                <div class="apply_wrap">
                    <div class="title_wrap">
                        <div class="title">
                            <h3>[${trainInfo.gbn} ${trainInfo.gbnDepth}] 교육 신청</h3>
                        </div>
                    </div>

                    <form id="applyForm" name="applyForm" method="post">
                        <input type="hidden" name="trainSeq" value="${seq}" />
                        <input type="hidden" name="memberSeq" value="${info.seq}" />

                        <div class="form_box">
                            <div class="form_title">
                                <h4>신청자 정보</h4>
                            </div>
                            <div class="form_content">
                                <dl>
                                    <dt>아이디</dt>
                                    <dd>${info.id}</dd>
                                </dl>
                                <dl>
                                    <dt>성명(국문)</dt>
                                    <dd>${info.name}</dd>
                                </dl>
                                <dl>
                                    <dt>성명(영문)</dt>
                                    <dd>${info.nameEn}</dd>
                                </dl>
                                <dl>
                                    <dt>연락처</dt>
                                    <dd>${info.phone}</dd>
                                </dl>
                                <dl>
                                    <dt>이메일</dt>
                                    <dd>${info.email}</dd>
                                </dl>
                                <dl>
                                    <dt>생년월일</dt>
                                    <dd>${info.birthYear}-${info.birthMonth}-${info.birthDay} (${info.sex})</dd>
                                </dl>
                                <dl class="address">
                                    <dt>주소</dt>
                                    <dd>${info.address} ${info.addressDetail}</dd>
                                </dl>
                            </div>
                        </div>

                        <c:choose>
                            <c:when test="${trainInfo.formType == 'BASIC_FORM'}">
                                <jsp:include page="_form_unified_basic.jsp" />
                            </c:when>
                            <c:when test="${trainInfo.formType == 'PRO_FORM'}">
                                <jsp:include page="_form_unified_pro.jsp" />
                            </c:when>
                            <%--<c:when test="${trainInfo.formType == 'FAMTOUR_FORM'}">
                                <jsp:include page="_form_unified_famtour.jsp" />
                            </c:when>--%>
                            <c:otherwise>
                                <div class="form_box">
                                    <p style="text-align:center; padding: 20px;">
                                        [오류] 잘못된 신청서 양식입니다. (form_type: ${trainInfo.formType})<br>
                                        관리자에게 문의하세요.
                                    </p>
                                </div>
                            </c:otherwise>
                        </c:choose>
                        <div class="form_box">
                            <div class="form_title">
                                <h4>개인정보 수집 및 이용 동의</h4>
                            </div>
                            <div class="form_content">
                                <div class="agree_box">
                                    <div class="text_box">
                                        <p>
                                            (재)경기해양레저인력양성센터는 「개인정보 보호법」 제15조(개인정보의 수집·이용), 제17조(개인정보의 제공), 제22조(동의를 받는 방법), 제24조(고유식별정보의 처리 제한)에 따라 귀하의 개인정보를 다음과 같이 수집·이용·제공하고자 합니다.
                                        </p>
                                        <p>
                                            1. 개인정보의 수집·이용 목적 : 교육 신청자 관리 및 교육 운영<br>
                                            2. 수집·이용하려는 개인정보의 항목 : 성명(국/영문), 연락처, 이메일, 생년월일, 성별, 주소, 기타 교육 신청 시 작성한 항목<br>
                                            3. 개인정보의 보유 및 이용 기간 : 수집·이용 동의일로부터 1년 또는 정보주체의 삭제 요청 시까지<br>
                                            4. 개인정보 수집 동의에 거부하실 수 있으며, 동의하지 않으실 경우 교육 신청이 제한될 수 있습니다.
                                        </p>
                                    </div>
                                    <div class="check_box">
                                        <input type="radio" id="agreeY" name="agree" value="Y" checked="checked">
                                        <label for="agreeY">동의함</label>
                                        <input type="radio" id="agreeN" name="agree" value="N">
                                        <label for="agreeN">동의하지 않음</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="btn_wrap">
                            <a href="javascript:void(0);" onclick="fn_apply_submit();" class="btn_apply">교육 신청하기</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- //container -->

    <c:import url="../footer.jsp" charEncoding="UTF-8"/>

    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.all.min.js"></script>

    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/jquery-migrate-3.3.0.js"></script>
    <script src="/js/jquery.cookie.min.js"></script>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script src="/js/script.js?ver=<%=System.currentTimeMillis()%>"></script>
    <script src="/js/swiper.js"></script>
    <script src="/js/form.js?ver=<%=System.currentTimeMillis()%>"></script>
    <script src="/js/smsNoti.js?ver=<%=System.currentTimeMillis()%>"></script>
    <script src="/js/main.js?ver=<%=System.currentTimeMillis()%>"></script>

    <script type="text/javascript">

        // 신청서 제출 (신규 통합 API 호출)
        function fn_apply_submit() {
            if (!$("input[name='agree']:checked").val() || $("input[name='agree']:checked").val() === 'N') {
                alert("개인정보 수집 및 이용에 동의하셔야 신청이 가능합니다.");
                return false;
            }

            // (필요시 폼 타입별 유효성 검사 추가)
            // var formType = "<%--${trainInfo.formType}--%>";
            // if (formType === 'BASIC_FORM') { ... }

            Swal.fire({
                title: '[ 교육 신청 ]',
                html: '교육을 신청하시겠습니까?',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#00a8ff',
                confirmButtonText: '신청하기',
                cancelButtonColor: '#A1A5B7',
                cancelButtonText: '취소'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    // 1. 폼 데이터 직렬화
                    var formData = $("#applyForm").serializeObject();
                    console.log("Unified Apply FormData:", formData);

                    // 2. 신규 통합 INSERT API 호출
                    _ajax_("POST", "/apply/eduApplyUnified/insert.do", formData, function (response) {
                        if (response.resultCode === "0") {

                            // 3. 성공 시 결제 페이지로 이동 (반환된 app_seq와 'UNIFIED' 타입 전달)
                            var appSeq = response.customValue; // Service에서 반환한 'AU000000X'
                            fn_payment(appSeq, 'UNIFIED');

                        } else {
                            Swal.fire('신청 실패', response.resultMessage, 'error');
                        }
                    });
                }
            });
        }

        // 결제 함수 (기존 form.js와 동일 + systemType 파라미터 추가)
        function fn_payment(seq, systemType) {
            $("#tableSeq").val(seq);
            $("#applicationSystemType").val(systemType); // ★신규: 시스템 타입('UNIFIED') 설정

            var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

            if (isMobile) {
                $("#payForm").attr("action", "/apply/mobile/payment.do");
            } else {
                $("#payForm").attr("action", "/apply/payment.do");
            }

            $("#payForm").submit();
        }
    </script>
</c:if>
</body>
</html>